#!/bin/bash
#
# Finds unusual system files by using the `lostfiles` utility, which compares
# it with pacman's database, and filtering some stuff out of there.

set -euo pipefail


sudo lostfiles | \
    # Ignore data generated by apps (even though they're storing it in the
    # wrong place :( )
    #   docker
    #   gdk-pixbuf
    #   texlive-fontsextra
    #   yousician
    grep -v \
        -e '^/etc/dhcpcd.secret$' \
        -e '^/etc/docker$' \
        -e '^/etc/docker/key.json$' \
        -e '^/etc/systemd/user/sockets.target.wants' \
        -e '^/etc/texmf/web2c/updmap.cfg$' \
        -e '^/opt/yousician/' | \
    # Ignore caches (even though, again, they shouldn't be there)
    grep -v \
        -e '\.cache$' \
        -e '/cache.zsh$' \
        -e '^/etc/gtk-2.0/gdk-pixbuf.loaders$' \
        -e '^/\(etc\|usr/share\)/texmf\(-dist\)\?/ls-R$' \
        -e '/__pycache__' \
        -e '^/usr/lib32/gdk-pixbuf-2.0' \
        -e '^/usr/lib/ghc-8.6.1/package.conf.d/' \
        -e '^/usr/lib/graphviz/config6$' \
        -e '^/usr/lib/udev/hwdb.bin$' \
        -e '^/usr/share/fonts/.*/fonts.\(dir\|scale\)$' \
        -e '^/usr/share/glib-2.0/schemas/gschemas.compiled$' \
        -e '\.uuid$' | \
    # Ignore intentional files
    grep -v \
        -e '^/etc/fonts/conf.avail/' \
        -e '^/etc/fonts/conf.d/' \
        -e '^/etc/fonts/local.conf$' \
        -e '^/etc/gconf/gconf.xml.defaults/%gconf-tree.xml$' \
        -e '^/etc/gitconfig$' \
        -e '^/etc/.gitignore$' \
        -e '^/etc/ld.so.preload$' \
        -e '^/etc/modprobe.d/nobeep.conf$' \
        -e '^/etc/modprobe.d/no-psmouse.conf$' \
        -e '^/etc/sysctl.d/20-quiet-printk.conf$' \
        -e '^/etc/sysctl.d/99-sysctl.conf$' \
        -e '^/etc/sysctl.d/local.conf$' \
        -e '^/etc/systemd/user/default.target.wants$' \
        -e '^/etc/systemd/user/default.target.wants/xdg-user-dirs-update.service$' \
        -e '^/etc/X11/xorg.conf.d/' \
        -e '^/usr/share/dict/dutch'
