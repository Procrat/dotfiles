#!/usr/bin/env bash
#
# Cleanly updates Arch, Neovim plugins and local Python packages.

set -euo pipefail

# Assert etckeeper's index is clean
if ! (cd /etc && sudo git diff-index --quiet HEAD); then
    echo '/etc is not clean. Please fix.' >&2
    cd /etc
    sudo git status
    exit 1
fi

BUILD_NOCONFIRM=1 EDITFILES=0 yaourt -Syua
paccache -r
yaourt -C
"$HOME/repos/dotfiles/setup.sh"
pip install --upgrade pip
pip-review -li
pip check
