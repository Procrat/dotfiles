#!/usr/bin/env bash
#
# Cleanly updates Arch, Neovim plugins, Tmux plugins and local Python packages.

set -euo pipefail

# Assert etckeeper's index is clean
if ! (cd /etc && sudo git diff-index --quiet HEAD); then
    echo '/etc is not clean. Please fix.' >&2
    cd /etc
    sudo git status
    exit 1
fi

# Show latest Arch Linux news
yay -w
yay
paccache -r -k2
sudo pacdiff

"$HOME/repos/dotfiles/setup.sh"

pip install --upgrade pip
pip-compile --upgrade \
    --output-file "$HOME/.config/pip/requirements.txt" \
    "$HOME/.config/pip/requirements.in"
pip-sync "$HOME/.config/pip/requirements.txt"
pip check

rustup update
cargo install-update -a
